@import model.viewmodels.ConsultationViewModel
@(model: ConsultationViewModel)

@js = {
    @*<script src="http://rangy.googlecode.com/svn/trunk/currentrelease/rangy-core.js" ></script>*@
      <script src="//tinymce.cachefly.net/4.1/tinymce.min.js"></script>
    <script src="@routes.Assets.at("js/react-with-addons.js")"></script>
    <script src="http://momentjs.com/downloads/moment-with-locales.min.js"></script>
    <script src="@routes.Assets.at("js/classnames.js")" ></script>
    <script src="@routes.Assets.at("js/consultation/commentBox-compiled.js")" ></script>
    <script  src="@routes.Assets.at("js/consultation/index.js")" ></script>
    <script>
     $(function(){
        var controller = new scify.ConsultationIndexPageHandler(@Html(model.annotationTypesToJson()),
                                                                @model.consultation.id,
                                                                @Html(if (model.user.isDefined) "'"+model.user.get.userID.toString+"'" else "''"),
                                                                @Html(if (model.user.isDefined) "'"+model.user.get.fullName.getOrElse("n/a")+"'" else "''"),
                                                                @Html(model.discussionThreadsToJson()),
                                                                @Html(model.relevantLawsToJson())
                                                                );
        controller.init();
        $("#relevantLawsBtn").on("click", function(){
            $("#relevantLawsBtn").toggleClass("clicked");
            if($("#relevantLawsBtn").hasClass("clicked")) {
                $("#relevantLawsBtn i").removeClass("fa-chevron-down");
                $("#relevantLawsBtn i").addClass("fa-chevron-up");
                $("#relevantLawsList .relevantMaterialContainer").show("slow");
            }
            else {
                $("#relevantLawsBtn i").removeClass("fa-chevron-up");
                $("#relevantLawsBtn i").addClass("fa-chevron-down");
                $("#relevantLawsList .relevantMaterialContainer").hide("fast");
            }
        });
     })
    </script>
}

@css = {
    <link rel="stylesheet" media="screen" href="@routes.Assets.at("css/consultation/consultation.css")">
    <link rel="stylesheet" href="http://css-spinners.com/css/spinner/spinner.css" type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
}

@layout("DemocracIT", css, js,None) {

    <section id="stats" class="container">


        Διάρκεια @model.consultation.totalDurationFormatted | @model.consultation.prettyDateFormat(model.consultation.startDate) έως @model.consultation.prettyDateFormat(model.consultation.endDate) | <a href="@model.consultation.opengov_url" target="_blank">open gov link</a>

            <div id="relevantMaterial" class="">
                <div class="relevantMaterialTitle">Σχετικό υλικό:</div>
                <div class="relevantMaterialContainer">
                @for(relevantMaterial <- model.relevantMaterials) {

                    <div class="url"><a href="@relevantMaterial.pdf_url"><i class="fa fa-file-pdf-o" style="margin-right: 5px"></i> @relevantMaterial.title</a></div>

                }
                </div>
            </div>


            @if(model.consultation.isActive) {
                <div class="consState activeCons">Ενεργή Διαβούλευση</div>
            } else {
                <div class="consState inactiveCons">Αυτή η διαβούλευση δεν είναι πλέον ενεργή.</div>
            }

            <ul class="statsFloatingList">
                <li>
                    <div id="relevantLawsList" class="">
                        <div class="relevantMaterialTitle">Βρέθηκαν @model.distinctLaws().length σχετικοί νόμοι @if(model.distinctLaws().length > 0){<div id="relevantLawsBtn"><i class="fa fa-chevron-down"></i></div>} <span class="divider">|</span></div>
                        <ul class="relevantMaterialContainer">
                        @for(relevantLaw <- model.distinctLaws()) {

                            <li class="url"><a href="@relevantLaw.pdf_url"> @relevantLaw.entity_text</a></li>

                        }
                        </ul>
                    </div>
                </li>
                <li>
                    <div  class="relevantMaterialTitle" data-toggle="modal" data-target="#initialMessagesModal">
                        Αρχικο Μήνυμα Διαβούλευσης <span class="divider">|</span>
                    </div>
                </li>
                <li>
                    <div  class="relevantMaterialTitle" data-toggle="modal" data-target="#ministerMessagesModal">
                        Μηνύματα Υπουργου <span class="divider">|</span>
                    </div>
                </li>
            </ul>
    </section>


    <div class="modal fade" id="initialMessagesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Αρχικο Μηνυμα Διαβούλευσης</h4>
                </div>
                <div class="modal-body">
                    <ul class="ministerMessagesList">

                        <li class="msg">@Html(model.consultation.shortDescr)</li>

                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Κλείσιμο</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="ministerMessagesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Μηνύματα Υπουργού</h4>
                </div>
                <div class="modal-body">
                    <ul class="ministerMessagesList">

                        <li class="msg">@Html(model.consultation.completed_text.orNull)</li>
                        <li class="msg">@Html(model.consultation.report_text.orNull)<div class="url"><a href="@model.consultation.report_url">Σύνδεσμος</a></div></li>

                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Κλείσιμο</button>
                </div>
            </div>
        </div>
    </div>

    <div id="wrapper" class="container">
        <section id="consultation-header">
        <div class="row">
            <div class="col-md-12 title" >
                @Html(model.consultation.title)
            </div>
        </div>
            </section>
        <section id="consultation-body">
            @for(article <- model.consultation.articles) {
                <div data-id="@article.id"  class="row article ">
                    <div class="col-md-12">
                        <div class="title">
                          <a class="show-hide btn collapsed" data-toggle="collapse" data-target="#body-@article.id"><span>-</span><span>+</span></a>
                          <span class="article-title-text">@article.title</span>
                        </div>
                        <div id="body-@article.id" class="collapse " style="height:0;" >
                            <div class="article-body">
                                @Html(article.body)
                            </div>
                            <div class="comment-wrp open-gov skip-ann" data-count="@article.commentsNum"></div>
                        </div>

                    </div>
                </div>
            }
        </section>
        <div id="comment-box-wrp"></div>
    </div>
    <div id="toolbar">

        <form action="@routes.AnnotationController.annotatePost()" method="post">

            <div>
                Επισημείωση για το τμήμα κειμένου:
                <blockquote></blockquote></div>
            <div>
            @if(model.user.isDefined){
                <hr>
                <select name="annotationTagId">
                    <option value="-1">Υπόδειξη προβλήματος:</option>
                    @for(annotation <- model.allowedAnnotations){
                        <option value="@annotation.id">@annotation.description</option>
                    }
                </select>
            </div>


            <div id="comment-wrap">
                Θα ηθελα να δηλωσω οτι:
                <textarea name="body"></textarea>
            </div>

            <input type="hidden" name="articleid" value=""/>
            <input type="hidden" name="discussionroomannotationtagid" value=""/>

            <button id="save-annotation" class="btn blue" type="submit">Καταχώρηση</button>
            <button class="close btn red" type="button" class="btn red" >Κλείσιμο</button>
            } else {
                <div class="notLoggedinWrapper">
                    <div class="msg"><i class="fa fa-exclamation-triangle"></i><p class="notLoggedText">Για αυτή την ενέργεια χρειάζεται να είστε <a href="/signIn">συνδεδεμένοι</a></p></div>
                </div>


        }
        </form>
    </div>

}




