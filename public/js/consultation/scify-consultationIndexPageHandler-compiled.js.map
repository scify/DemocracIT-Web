{"version":3,"sources":["scify-consultationIndexPageHandler.js"],"names":[],"mappings":"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","file":"scify-consultationIndexPageHandler-compiled.js","sourcesContent":["\nscify.ConsultationIndexPageHandler = function( consultationid,userId,fullName,\n                                              discussionThreads,\n                                              relevantLaws,\n                                              consultationEndDate){\n    this.consultationid= consultationid;\n    this.userId = userId;\n    this.fullName = fullName;\n\n    this.discussionThreads ={};\n    for (var i=0; i<discussionThreads.length; i++) //create a map for quick access with id: The discussion thread client id and value: a object with info.\n    {\n        this.discussionThreads[discussionThreads[i].clientId]= { id: discussionThreads[i].id, num:discussionThreads[i].numberOfComments }\n    }\n\n    this.relevantLaws = [];\n    console.log(relevantLaws);\n    for (var i=0; i<relevantLaws.length; i++) {\n        this.relevantLaws[i] = {article_id: relevantLaws[i].article_id ,entity_text : relevantLaws[i].entity_text, pdf_url: relevantLaws[i].pdf_url}\n    }\n\n    this.consultationEndDate = consultationEndDate;\n\n};\nscify.ConsultationIndexPageHandler.prototype = function(){\n\n    var expandArticleOnClick = function(){\n        var article = $(this).closest(\".article\");\n        if (!article.find(\".article-body\").hasClass(\"in\"))\n            article.find(\".show-hide\").trigger(\"click\");\n    },\n    getDiscussionThreadNumberOfComments = function(articleId,annotationId){\n        if (this.discussionThreads.hasOwnProperty(getDiscussionThreadClientId(articleId,annotationId)))\n            return this.discussionThreads[getDiscussionThreadClientId(articleId,annotationId)].num\n\n        return 0;\n    },\n    getDiscussionThreadId = function(articleId,annotationId){\n\n        if (this.discussionThreads.hasOwnProperty(getDiscussionThreadClientId(articleId,annotationId)))\n            return this.discussionThreads[getDiscussionThreadClientId(articleId,annotationId)].id\n\n        return -1;\n\n    },\n    createDiscussionRooms = function(){\n        var instance = this;\n        //todo: load existing rooms from database\n        scify.discussionRooms={}; //an object that will contain reference to all the React divs that host the comments\n        $(\".article\").each(function(index,articleDiv){\n            var articleid =$(articleDiv).data(\"id\");\n\n            var commentBoxProperties= {\n                consultationid          : instance.consultationid,\n                consultationEndDate    : instance.consultationEndDate,\n                articleid               : articleid,\n                discussionthreadid      : -1,\n                discussionthreadclientid: getDiscussionThreadClientId(articleid),\n                source :\"opengov\",\n                commentsCount : $(articleDiv).find(\".open-gov\").data(\"count\")  //for open gov we retrieve the counter from\n            };\n            var domElementToAddComponent = $(articleDiv).find(\".open-gov\")[0];\n            scify.discussionRooms[commentBoxProperties.discussionthreadclientid] = React.render(React.createElement(scify.CommentBox, commentBoxProperties),domElementToAddComponent );\n\n            $(articleDiv).find(\".ann\").each(function(i,ann){\n                var annId = $(ann).data(\"id\");\n                commentBoxProperties.discussionthreadclientid = getDiscussionThreadClientId(articleid,annId );\n                commentBoxProperties.discussionthreadid = getDiscussionThreadId.call(instance,articleid,annId );\n                commentBoxProperties.commentsCount  = getDiscussionThreadNumberOfComments.call(instance,articleid,annId )\n                commentBoxProperties.source=\"dm\";\n                commentBoxProperties.userId = instance.userId;\n                commentBoxProperties.fullName = instance.fullName;\n                commentBoxProperties.discussionThreadText = $(this).text().replace($(this).find(\".ann-icon\").text(),\"\");\n                $(ann).after('<div class=\"commentbox-wrap\"></div>');\n                domElementToAddComponent = $(ann).next()[0];\n                scify.discussionRooms[commentBoxProperties.discussionthreadclientid] =React.render(React.createElement(scify.CommentBox, commentBoxProperties),domElementToAddComponent );\n            });\n        });\n    },\n    getDiscussionRoom = function(articleid,annId){\n        return scify.discussionRooms[getDiscussionThreadClientId(articleid,annId)];\n    },\n    getDiscussionThreadClientId = function(articleid,annId){\n        return articleid+(annId ? annId :\"\");\n    },\n    addRelevantLawsHandler = function(){\n        $(\".relevantLawsBtn\").on(\"click\", function(){\n            console.log($(this).context.id);\n            $(\".relevantLaw #\" + $(this).context.id + \" .relevantLawsBtn\").toggleClass(\"clicked\");\n            if($(\".relevantLaw #\" + $(this).context.id + \" .relevantLawsBtn\").hasClass(\"clicked\")) {\n                $(\".relevantLaw #\" + $(this).context.id + \" i\").removeClass(\"fa-chevron-down\");\n                $(\".relevantLaw #\" + $(this).context.id + \" i\").addClass(\"fa-chevron-up\");\n                $(\".relevantLaw #\" + $(this).context.id + \" .childLaws\").show(\"slow\");\n            }\n            else {\n                $(\".relevantLaw #\" + $(this).context.id + \" i\").removeClass(\"fa-chevron-up\");\n                $(\".relevantLaw #\" + $(this).context.id + \" i\").addClass(\"fa-chevron-down\");\n                $(\".relevantLaw #\" + $(this).context.id + \" .childLaws\").hide(\"fast\");\n            }\n        });\n    },\n    handleAnnotationSave = function(e){\n        var instance = this;\n        var form = $(\"#toolbar-modal\").find(\"form\");\n        var data = instance.annotator.collectAnnotatorData(e);\n        getDiscussionRoom(data.articleid,data.discussionroomannotationtagid).saveComment(form.attr(\"action\"),data);\n        instance.annotator.hideToolBar();\n     },\n    replaceRelevantLaws = function(relevantLaws) {\n            for (var i=0; i<relevantLaws.length; i++) {\n                var replaceText = relevantLaws[i].entity_text;\n                var replacedHtml = $(\"div[data-id=\"+ relevantLaws[i].article_id +\"]\").html().replace(relevantLaws[i].entity_text, \"<a target='_blank' href='\" + relevantLaws[i].pdf_url + \"'>\" + replaceText + \"</a>\");\n                $(\"div[data-id=\"+ relevantLaws[i].article_id +\"]\").html(replacedHtml);\n            }\n        },\n    removeParagraphsWithNoText = function(){\n            $(\".message\").find(\"p\").each(function(i,el){\n                if ($.trim($(this).text()).length==0)\n                    $(this).remove();\n            });\n        }\n    init = function(){\n        var instance= this;\n        moment.locale('el');\n\n        this.annotator = new scify.Annotator(false);\n        this.annotator.init();\n\n        replaceRelevantLaws(this.relevantLaws);\n        addRelevantLawsHandler();\n        $(\".article-title-text\").click(expandArticleOnClick);\n        $(\".article-title-text\").first().trigger(\"click\");\n\n        createDiscussionRooms.call(instance);\n        removeParagraphsWithNoText();\n        //tinymce.init({selector:'textarea'})\n\n        $( \"#tutorial\" ).on( \"click\", function() {\n            introJs().start();\n        });\n    };\n\n    return {\n        init:init\n    }\n}();\n\n\n\n"]}